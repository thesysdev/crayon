import { Meta } from "@storybook/blocks";
import * as ShellStories from "./Shell.stories";

<Meta of={ShellStories} />

# Shell

The Shell is a **full-page composable chat interface** with a sidebar for thread management. It's designed for applications where chat is the primary interface, providing a complete desktop and mobile experience.

## Component Structure

```
ChatProvider
└── Container                    (full-page wrapper)
    ├── SidebarContainer         (collapsible sidebar)
    │   ├── SidebarHeader        (logo, agent name, collapse button)
    │   └── SidebarContent
    │       ├── NewChatButton
    │       ├── SidebarSeparator
    │       └── ThreadList
    └── ThreadContainer          (main chat area)
        ├── MobileHeader         (mobile-only header)
        ├── ScrollArea           (scrollable message area)
        │   └── Messages
        ├── ConversationStarter  (optional, shown when empty)
        └── Composer             (text input)
```

## Basic Usage

```tsx
import { ChatProvider, useThreadListManager, useThreadManager } from "@crayonai/react-core";
import {
  Composer,
  Container,
  ConversationStarter,
  MessageLoading,
  Messages,
  MobileHeader,
  NewChatButton,
  ScrollArea,
  SidebarContainer,
  SidebarContent,
  SidebarHeader,
  SidebarSeparator,
  ThreadContainer,
  ThreadList,
} from "@crayonai/react-ui/Shell";

function MyShell() {
  const threadListManager = useThreadListManager({
    createThread: async () => ({
      threadId: crypto.randomUUID(),
      title: "New Chat",
      createdAt: new Date(),
      isRunning: false,
    }),
    fetchThreadList: async () => [],
    deleteThread: async () => {},
    updateThread: async (t) => t,
    onSwitchToNew: () => {},
    onSelectThread: () => {},
  });

  const threadManager = useThreadManager({
    threadId: threadListManager.selectedThreadId,
    loadThread: async (threadId) => {
      if (!threadId) return [];
      // Load messages for thread
      return [];
    },
    onProcessMessage: async ({ message, threadManager }) => {
      threadManager.appendMessages({ ...message, id: crypto.randomUUID() });
      // Send message to your AI backend
      // Return assistant response
      return [
        {
          id: crypto.randomUUID(),
          role: "assistant",
          type: "response",
          message: [{ type: "text", text: "Response from AI" }],
        },
      ];
    },
    responseTemplates: [],
  });

  return (
    <ChatProvider threadListManager={threadListManager} threadManager={threadManager}>
      <Container logoUrl="/path/to/logo.png" agentName="AI Assistant">
        <SidebarContainer>
          <SidebarHeader />
          <SidebarContent>
            <NewChatButton />
            <SidebarSeparator />
            <ThreadList />
          </SidebarContent>
        </SidebarContainer>
        <ThreadContainer>
          <MobileHeader />
          <ScrollArea>
            <Messages loader={<MessageLoading />} />
          </ScrollArea>
          <ConversationStarter
            starters={[
              { displayText: "Help me get started", prompt: "Help me get started" },
              { displayText: "What can you do?", prompt: "What can you do?" },
            ]}
          />
          <Composer />
        </ThreadContainer>
      </Container>
    </ChatProvider>
  );
}
```

## Individual Components

### Container

The main full-page wrapper for the Shell.

```tsx
<Container
  logoUrl="/logo.png" // Logo shown in sidebar header
  agentName="AI Assistant" // Name shown in sidebar header
  className="custom-class" // Optional custom styling
>
  {children}
</Container>
```

### Sidebar Components

The sidebar provides thread management and navigation.

```tsx
<SidebarContainer>
  <SidebarHeader /> {/* Logo, name, collapse button */}
  <SidebarContent>
    <NewChatButton /> {/* Creates new thread */}
    <SidebarSeparator /> {/* Visual separator */}
    <ThreadList /> {/* List of existing threads */}
  </SidebarContent>
</SidebarContainer>
```

### ThreadContainer

Wrapper for the main chat area with optional artifact panel support.

```tsx
<ThreadContainer
  isArtifactActive={false} // Show artifact panel (desktop: side-by-side, mobile: overlay)
  renderArtifact={() => <div />} // Artifact content
>
  {children}
</ThreadContainer>
```

### MobileHeader

Header shown only on mobile devices with sidebar toggle.

```tsx
<MobileHeader />
```

### ScrollArea

Scrollable container for messages with smart scroll behavior.

```tsx
<ScrollArea
  scrollVariant="user-message-anchor" // Scroll behavior
  userMessageSelector=".crayon-shell-thread-message-user" // CSS selector for user messages
>
  <Messages loader={<MessageLoading />} />
</ScrollArea>
```

### ConversationStarter

Full-width clickable buttons shown when the thread is empty. Automatically submits the prompt as a message when clicked.

```tsx
<ConversationStarter
  starters={[
    { displayText: "Help me get started", prompt: "Help me get started" },
    { displayText: "What can you do?", prompt: "What can you do?" },
    { displayText: "Tell me about your features", prompt: "Tell me about your features" },
  ]}
  className="custom-class" // Optional custom styling
/>
```

**Props:**

- `starters` - Array of objects with `displayText` (shown on button) and `prompt` (sent as message)
- `className` - Optional additional CSS class

**Behavior:**

- Only visible when there are no messages in the thread
- Clicking a button submits the `prompt` as a user message
- Buttons are disabled when a response is being generated
- Respects Shell layout (centered with max-width, mobile padding)

### Composer

Text input for sending messages.

```tsx
<Composer className="custom-class" />
```

## Desktop vs Mobile

The Shell automatically adapts to screen size:

| Feature               | Desktop                 | Mobile                                |
| --------------------- | ----------------------- | ------------------------------------- |
| Sidebar               | Collapsible side panel  | Hidden, accessible via hamburger menu |
| Header                | In sidebar              | MobileHeader at top of thread         |
| Artifact panel        | Resizable side-by-side  | Full-screen overlay                   |
| Conversation starters | Centered with max-width | Full-width with padding               |

## Artifact Panel

The Shell supports a resizable artifact panel on desktop:

```tsx
<ThreadContainer
  isArtifactActive={true}
  renderArtifact={() => <div>{/* Your artifact content (code preview, document, etc.) */}</div>}
>
  {/* Chat content */}
</ThreadContainer>
```

On desktop, the artifact panel appears to the right of the chat and can be resized by dragging the separator. On mobile, it appears as a full-screen overlay.

## Comparison with Other Components

| Feature        | Shell             | CopilotShell       | BottomTray             |
| -------------- | ----------------- | ------------------ | ---------------------- |
| Layout         | Full page         | Sidebar panel      | Floating panel         |
| Sidebar        | Yes (collapsible) | No                 | No                     |
| Thread list    | Yes               | No                 | Yes (in header)        |
| Artifact panel | Yes (resizable)   | Yes (overlay)      | No                     |
| Mobile         | Responsive        | Responsive         | Fullscreen             |
| Use case       | Primary chat app  | Side panel copilot | Secondary/support chat |

## CSS Classes

All Shell components use the `crayon-shell-` prefix:

- `.crayon-shell-container`
- `.crayon-shell-thread-container`
- `.crayon-shell-thread-scroll-area`
- `.crayon-shell-thread-messages`
- `.crayon-shell-thread-message-user`
- `.crayon-shell-thread-message-assistant`
- `.crayon-shell-thread-composer`
- `.crayon-shell-conversation-starter`
- `.crayon-shell-conversation-starter-item`
- `.crayon-shell-sidebar-container`
- `.crayon-shell-sidebar-header`
- `.crayon-shell-sidebar-content`
