import { Meta } from "@storybook/blocks";
import * as ShellStories from "./Shell.stories";

<Meta of={ShellStories} />

# CopilotShell

The CopilotShell is a **composable sidebar chat interface** designed to be embedded as a side panel in your application. It uses a composition pattern, giving you full control over placement and styling.

## Component Structure

```
ChatProvider
└── Container            (sidebar panel)
    └── ThreadContainer
        ├── Header           (logo, agent name)
        ├── ScrollArea       (scrollable message area)
        │   └── Messages
        ├── ConversationStarter  (optional, shown when empty)
        └── Composer         (text input)
```

## Basic Usage

```tsx
import { useState } from "react";
import { ChatProvider, useThreadListManager, useThreadManager } from "@crayonai/react-core";
import {
  Composer,
  Container,
  ConversationStarter,
  Header,
  MessageLoading,
  Messages,
  ScrollArea,
  ThreadContainer,
} from "@crayonai/react-ui/CopilotShell";

function MyCopilot() {
  const threadListManager = useThreadListManager({
    createThread: async () => ({
      threadId: crypto.randomUUID(),
      title: "New Chat",
      createdAt: new Date(),
      isRunning: false,
    }),
    fetchThreadList: async () => [],
    deleteThread: async () => {},
    updateThread: async (t) => t,
    onSwitchToNew: () => {},
    onSelectThread: () => {},
  });

  const threadManager = useThreadManager({
    threadId: threadListManager.selectedThreadId,
    loadThread: async (threadId) => {
      if (!threadId) return [];
      // Load messages for thread
      return [];
    },
    onProcessMessage: async ({ message, threadManager }) => {
      threadManager.appendMessages({ ...message, id: crypto.randomUUID() });
      // Send message to your AI backend
      // Return assistant response
      return [
        {
          id: crypto.randomUUID(),
          role: "assistant",
          type: "response",
          message: [{ type: "text", text: "Response from AI" }],
        },
      ];
    },
    responseTemplates: [],
  });

  return (
    <ChatProvider threadListManager={threadListManager} threadManager={threadManager}>
      <Container logoUrl="/path/to/logo.png" agentName="AI Assistant">
        <ThreadContainer>
          <Header />
          <ScrollArea>
            <Messages loader={<MessageLoading />} />
          </ScrollArea>
          <ConversationStarter
            starters={[
              { displayText: "Help me get started", prompt: "Help me get started" },
              { displayText: "What can you do?", prompt: "What can you do?" },
            ]}
          />
          <Composer />
        </ThreadContainer>
      </Container>
    </ChatProvider>
  );
}
```

## Individual Components

### Container

The main wrapper for the CopilotShell sidebar.

```tsx
<Container
  logoUrl="/logo.png" // Logo shown in header
  agentName="AI Assistant" // Name shown in header
  className="custom-class" // Optional custom styling
>
  {children}
</Container>
```

### ThreadContainer

Wrapper for the thread content with optional artifact panel support.

```tsx
<ThreadContainer
  isArtifactActive={false} // Show artifact panel
  renderArtifact={() => <div />} // Artifact content
>
  {children}
</ThreadContainer>
```

### Header

The header with logo and agent name.

```tsx
<Header />
```

### ScrollArea

Scrollable container for messages with smart scroll behavior.

```tsx
<ScrollArea
  scrollVariant="user-message-anchor" // Scroll behavior
  userMessageSelector=".crayon-copilot-shell-thread-message-user" // CSS selector for user messages
>
  <Messages loader={<MessageLoading />} />
</ScrollArea>
```

### ConversationStarter

Full-width clickable buttons shown when the thread is empty. Automatically submits the prompt as a message when clicked.

```tsx
<ConversationStarter
  starters={[
    { displayText: "Help me get started", prompt: "Help me get started" },
    { displayText: "What can you do?", prompt: "What can you do?" },
    { displayText: "Tell me about your features", prompt: "Tell me about your features" },
  ]}
  className="custom-class" // Optional custom styling
/>
```

**Props:**

- `starters` - Array of objects with `displayText` (shown on button) and `prompt` (sent as message)
- `className` - Optional additional CSS class

**Behavior:**

- Only visible when there are no messages in the thread
- Clicking a button submits the `prompt` as a user message
- Buttons are disabled when a response is being generated

### Composer

Text input for sending messages.

```tsx
<Composer className="custom-class" />
```

## Layout Integration

CopilotShell is designed to be placed as a sidebar:

```tsx
function AppLayout() {
  return (
    <div style={{ display: "flex", height: "100vh" }}>
      {/* Main content area */}
      <main style={{ flex: 1 }}>{/* Your app content */}</main>

      {/* Copilot sidebar */}
      <aside style={{ width: 400, borderLeft: "1px solid #eee" }}>
        <ChatProvider {...}>
          <Container logoUrl={logo} agentName="Assistant">
            <ThreadContainer>
              <Header />
              <ScrollArea>
                <Messages loader={<MessageLoading />} />
              </ScrollArea>
              <ConversationStarter starters={[...]} />
              <Composer />
            </ThreadContainer>
          </Container>
        </ChatProvider>
      </aside>
    </div>
  );
}
```

## Comparison with BottomTray

| Feature  | CopilotShell        | BottomTray             |
| -------- | ------------------- | ---------------------- |
| Layout   | Sidebar panel       | Floating panel         |
| Position | Fixed sidebar       | Bottom-right corner    |
| Trigger  | Always visible      | Floating button        |
| Mobile   | Responsive          | Fullscreen             |
| Use case | Main chat interface | Secondary/support chat |

## CSS Classes

All CopilotShell components use the `crayon-copilot-shell-` prefix:

- `.crayon-copilot-shell-thread-container`
- `.crayon-copilot-shell-thread-scroll-area`
- `.crayon-copilot-shell-thread-messages`
- `.crayon-copilot-shell-thread-message-user`
- `.crayon-copilot-shell-thread-message-assistant`
- `.crayon-copilot-shell-thread-composer`
- `.crayon-copilot-shell-conversation-starter`
- `.crayon-copilot-shell-conversation-starter-item`
